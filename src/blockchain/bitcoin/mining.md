---
title: 挖矿
category:
  - 区块链
  - 比特币
  - 挖矿
order: 4
---

# 挖矿

挖矿（英语：Mining），是指透过执行工作量证明(POW)或其他类似的电脑算法来获取加密货币，例如比特币、以太币、莱特币等。由于此名称源自对采矿的比喻，进行挖矿工作的人通常称为矿工[1](https://zh.wikipedia.org/wiki/%E6%8C%96%E7%A4%A6_(%E6%95%B8%E4%BD%8D%E8%B2%A8%E5%B9%A3))。

> 工作量证明POW是英文Proof of Work的缩写

## 1. 挖矿过程中的核心问题

### 1.1 区块重组机制
在挖矿过程中，当监听到区块链上新发布的区块时，本地节点必须立即停止当前工作并重新组装候选区块。这是因为：

- **交易状态变更**：新区块中的交易会影响本地正在挖的区块内容
- **Merkle树重构**：需要重新打包交易并计算新的 MerkleRootHash
- **指针更新**：前一个区块的哈希指针需要指向链上最新区块

### 1.2 挖矿的无记忆性特质
挖矿具有**无记忆性**的重要特征：
- 前面的挖矿工作不会影响后续结果
- 无论继续挖之前的区块还是重新开始，成功概率相同
- 只要尚未找到有效 nonce，之前的工作对结果没有影响

### 1.3 挖矿成功的不确定性
即使成功挖出 nonce，也可能因以下原因无法写入区块链：
- **竞态条件**：所在分叉不是最长合法链
- **交易冲突**：存储的交易与其他区块冲突
- **双花检测**：被判断为 double spending 导致验证失败

## 2. 挖矿设备的演进历程

### 2.1 第一代：CPU 挖矿
**特点**：使用通用计算机的 CPU 进行挖矿

**缺陷**：
- 资源利用率低：内存大部分闲置
- 指令利用不充分：只用到 CPU 的部分指令
- 硬盘等资源浪费严重
- 随着难度提升，性价比急剧下降

### 2.2 第二代：GPU 挖矿
**优势**：
- 挖矿效率相比 CPU 大幅提升
- 适合大规模并行计算

**局限性**：
- 设计用于通用并行计算，挖矿时部分功能闲置
- 浮点运算资源对挖矿无用（挖矿只涉及整数运算）
- 随着难度提升逐渐失去经济效益

### 2.3 第三代：ASIC 芯片
**ASIC**（Application Specific Integrated Circuit，专用集成电路）

**优势**：
- 专门为挖矿设计，无多余电路逻辑
- 性价比最高
- 算力强劲

**问题**：
- **功能单一**：只能挖特定加密货币
- **研发周期长**：价格波动可能导致投资打水漂
- **快速淘汰**：几个月就可能过时
- **预订制度**：需要提前预定，存在被厂家"先挖"的风险

### 2.4 ASIC 设备的商业问题
无良厂家的常见做法：
1. 芯片制造完成后不立即交货
2. 以"测试期"为名自己先挖矿 2 个月
3. 造成算力突然集中，挖矿难度暴涨
4. 违背比特币"去中心化"的设计初衷

**应对方案**：新兴加密货币设计 **Alternative Mining Puzzle**，实现 **ASIC Resistance**（抗 ASIC 化），让通用计算机也能参与挖矿。

## 3. 大型矿池机制

### 3.1 矿池出现的背景
**单个矿工面临的问题**：
- 收入极不稳定（类似买彩票）
- 需要承担全节点的所有责任
- 即使使用 ASIC 芯片，出块周期仍然很长

### 3.2 矿池的优势
- **任务分工**：矿工专注哈希计算，矿主负责全节点功能
- **收入稳定**：多节点协作，收益共享
- **技术简化**：ASIC 芯片专注哈希计算即可

### 3.3 矿池架构
**基本结构**：一个全节点驱动多个矿机

**组织形式**：
1. **集中式**：大型数据中心，矿机属于同一机构
2. **分布式**：矿机来自不同机构，通过协议连接

### 3.4 收益分配机制
**分配依据**：根据每个矿工的贡献大小进行分红

**工作量证明**：
- 矿主降低挖矿难度，设置较低目标阈值
- 矿工提交符合阈值的 **Share**（almost valid block）
- Share 作为工作量证明，决定分红比例
- Share 无法写入区块链，但能证明工作量

## 4. 矿工的潜在问题

### 4.1 私藏区块问题
**场景**：矿工挖出成功区块但私自发布

**实际效果**：无效，因为：
- 区块由矿主组装
- 铸币交易收款人是矿主公钥
- 最终奖励仍归矿主所有

### 4.2 篡改交易问题
**场景**：矿工修改铸币交易收款人为自己

**检测机制**：
- 修改交易会改变 MerkleRoot 哈希值
- Share 在矿主处无法通过校验
- 等同于矿工单干，无法获得工作量证明

### 4.3 恶意丢弃区块
**场景**：矿工故意丢弃挖到的区块

**动机**：
- 虽然对矿工本身不经济
- 可能是敌对矿池派遣的"卧底"
- 目的是扰乱竞争对手的矿池运营

## 5. 矿池的潜在危害

### 5.1 算力集中化风险
**历史案例**：
- GHash.IO 矿池曾占据 51% 算力
- 具备发动 51% 攻击的能力
- 引发市场恐慌后主动降低算力

### 5.2 隐蔽性攻击
**潜在威胁**：
- 单一机构可能控制多个矿池
- 表面分散实则集中的算力分布
- 攻击时可快速整合算力
- 矿池转换操作简单快捷

### 5.3 诱导性攻击
**攻击策略**：
- 恶意矿主降低管理费吸引矿工
- 甚至赔本经营扩大算力
- 达到攻击门槛后发动攻击
- 类似云计算的"按需调用"模式

## 6. 51% 攻击详解

### 6.1 分叉攻击
**攻击流程**：
1. A 向 B 转账，交易写入区块 1 并获得 6 次确认
2. B 认为交易安全，确认收款
3. 攻击者创建区块 A，包含 A 向 A2（攻击者账户）的转账
4. 利用 51% 算力使区块 A 分叉成为最长合法链
5. 原转账被回滚，攻击者获得资金

```
                    ┌─────────────┐
                    │ A --转账--> B │
                    └─────────────┘


┌────┐ <-- ┌────┐ <-- ┌────┐ <-- ┌────┐ <-- ┌────┐ <-- ┌────┐ <-- ┌────┐
│区块0│     │区块1│     │区块2│     │区块3│     │区块4│     │区块5│     │区块6│
└────┘     └────┘     └────┘     └────┘     └────┘     └────┘     └────┘
  ^                                                                      
  |                                                                      
  |          ┌ ─ ─ ─ ─ ┐    ┌ ─ ─ ─ ─ ┐                                 
  └ ─ ─ ─ ─ ─│  区块A  │<---│  区块B  │                                 
             └ ─ ─ ─ ─ ┘    └ ─ ─ ─ ─ ┘                                 


                    ┌──────────────┐
                    │ A --转账--> A2 │
                    └──────────────┘
```

**特点**：参与的矿工并不知情，只是执行矿主分配的哈希计算任务。

### 6.2 封锁攻击（Boycott）

                    ┌─────────────┐
                    │ A --转账--> B │
                    └─────────────┘


┌────┐ <-- ┌────┐
│区块0│     │区块1│
└────┘     └────┘
  ^
  |
  |          ┌ ─ ─ ─ ─ ┐    ┌ ─ ─ ─ ─ ┐
  └ ─ ─ ─ ─ ─│  区块A  │<---│  区块B  │
             └ ─ ─ ─ ─ ┘    └ ─ ─ ─ ─ ┘


                ┌──────────────────┐
                │  不包含A转B交易的  │
                │      区块        │
                └──────────────────┘

**攻击目标**：封锁特定账户 A 的所有交易

**攻击方式**：
- 发现包含账户 A 交易的区块立即分叉
- 产生不包含 A 账户交易的替代区块
- 利用算力优势使自己的分叉成为主链

**连锁效应**：
- 诚实矿工逐渐不敢打包 A 的交易
- 避免自己的区块成为 orphan block
- 最终实现对目标账户的完全封锁

:::tip
这种攻击类似于分叉攻击，但是稍有不同。它不需要等待6个 confirmation之后再分叉（分叉攻击中需要等6个confirmation，让对方账户以为自己收到钱之后再攻击回滚交易）。只要发现有包含A账户的交易的区块上链，就马上进行分叉，并将自己的分叉变为最长合法链。
:::

## 7. 总结与思考

挖矿技术的发展体现了区块链系统的演进过程，从最初的去中心化理想到现实中的集中化趋势。虽然技术进步提高了挖矿效率，但也带来了新的安全挑战。理解这些机制对于参与和评估区块链系统的安全性至关重要。

**关键要点**：
- 挖矿设备的演进反映了效率与去中心化之间的权衡
- 矿池机制解决了个体矿工的问题，但引入了新的风险
- 51% 攻击威胁依然存在，需要持续关注算力分布
- 技术发展需要在效率、安全性和去中心化之间寻求平衡

