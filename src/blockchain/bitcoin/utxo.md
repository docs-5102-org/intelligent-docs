---
title: UTXO模型
category:
  - 区块链
  - 比特币
---

# UTXO 模型详解

## 什么是 UTXO？

UTXO（Unspent Transaction Output，未花费交易输出）是比特币区块链中的核心概念。它代表了尚未被使用的交易输出，是比特币网络中记录和验证资金所有权的基础数据结构。

简单来说，UTXO 就是"还没有被花掉的钱"。

## UTXO 的基本原理

### 什么构成一个 UTXO？

每个 UTXO 包含两个关键信息：

1. **交易哈希值（Transaction Hash）**：产生这个输出的交易的唯一标识
2. **输出索引（Output Index）**：该输出在该交易中的位置（第几个输出）

### UTXO 集合

比特币全节点在内存中维护一个 UTXO 集合，这个集合包含了当前区块链上所有未被花费的交易输出。这个数据结构对于：

- **验证交易合法性**：确保要花费的币确实存在且未被使用
- **防止双花攻击**：快速检测是否有人试图重复花费同一笔资金
- **维护网络状态**：实时跟踪整个网络的资金分布

## UTXO 的工作机制

### 交易输出的生命周期

1. **创建阶段**：当一笔交易被确认后，其所有输出都会被添加到 UTXO 集合中
2. **存在阶段**：输出在 UTXO 集合中等待被使用
3. **消费阶段**：当该输出被用作新交易的输入时，它会从 UTXO 集合中移除

### 实际例子

假设有一笔交易包含多个输出：

```
交易 TX123456:
- 输出 0: A 给 B 转账 5 BTC
- 输出 1: A 给 C 转账 3 BTC
```

初始状态下，两个输出都在 UTXO 中：
- `(TX123456, 0) → 5 BTC 属于 B`
- `(TX123456, 1) → 3 BTC 属于 C`

如果 B 花掉了收到的 5 BTC：
- `(TX123456, 0)` 从 UTXO 中移除
- `(TX123456, 1)` 仍然在 UTXO 中

这说明同一笔交易的不同输出可以独立地被花费。

## 交易的输入输出平衡

### 基本原则

每笔比特币交易都必须遵循一个基本规则：

```
输入总金额 = 输出总金额 + 交易费
```

### 交易费机制

当输入略大于输出时，差额就是交易费：

```
输入: 1.00 BTC
输出: 0.99 BTC
交易费: 0.01 BTC (给矿工)
```

### 多重签名要求

由于一笔交易可能包含来自不同地址的多个输入，因此需要：

- 每个输入地址都必须提供相应的数字签名
- 验证每个签名的有效性
- 确保签名者有权花费对应的 UTXO

## UTXO 模型的优势

### 1. 并行处理能力

不同的 UTXO 之间相互独立，可以并行验证多笔交易，提高网络处理效率。

### 2. 简化验证过程

验证交易只需检查：
- 输入的 UTXO 是否存在于当前 UTXO 集合中
- 签名是否有效
- 输入输出金额是否平衡

### 3. 防止双花攻击

通过维护实时的 UTXO 集合，可以立即检测到重复花费的尝试。

### 4. 状态一致性

UTXO 模型确保了整个网络对资金状态的一致理解，避免了复杂的状态同步问题。

## UTXO 模型 vs 账户模型

| 特性 | UTXO 模型 | 账户模型 |
|------|-----------|----------|
| 代表项目 | 比特币 | 以太坊 |
| 状态存储 | 未花费输出集合 | 账户余额 |
| 交易验证 | 检查 UTXO 存在性 | 检查账户余额 |
| 并行性 | 高（独立 UTXO） | 低（账户状态依赖） |
| 隐私性 | 较好 | 一般 |

## 参考资料

- https://www.yuque.com/tmfl/block_chain/tr2gppgt53ogi5up#UTXO

## 总结

UTXO 模型是比特币的核心机制，通过维护"未花费交易输出"集合来追踪资金状态。每个 UTXO 由交易哈希和输出索引唯一标识，全节点在内存中维护这个集合以快速验证交易合法性和防止双花。

UTXO 模型的核心优势在于：支持并行处理、简化交易验证、确保状态一致性，是比特币网络安全性和效率的重要保障。