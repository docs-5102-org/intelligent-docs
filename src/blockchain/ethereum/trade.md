---
title: 交易
category:
  - 区块链
  - 以太坊
---

好的 👍 我帮你把这份内容重新整理、优化成一篇结构清晰的 **《以太坊交易》** Markdown 文档，便于阅读和学习。

---

# 以太坊交易

在比特币中，交易本质上是消耗已有的 **UTXO**，并通过脚本产生新的 UTXO，其中差额部分作为矿工手续费。  
而在以太坊中，交易费用被称为 **Gas（汽油）**，它的计算和使用比比特币要复杂得多。

---

## 1. 以太坊交易的类型
以太坊支持两类主要交易：

1. **转账交易**  
   - 从一个外部账户向另一个外部账户转移 ETH。  
   - 消耗的 Gas 是固定的（21,000）。  

2. **合约交易**  
   - 外部账户调用合约中的某个 public 函数。  
   - 可能包含逻辑判断、循环、存储操作等，消耗的 Gas 不固定，需要预估。  

---

## Gas 机制

### 为什么需要 Gas？
以太坊支持执行 **图灵完备的合约代码**。  
为了避免无限循环等恶意代码消耗网络资源，每一条 **EVM 指令**都对应一个 Gas 费用：  
- 加减运算：`3`  
- SHA3 计算：`30`  
- 输出日志：`375`  
- 写入存储：`20,000`  

**总体规律**：  
- CPU 计算 < 存储操作  
- 简单操作 < 复杂操作  
- 读取 < 写入  

### Gas 的两个关键参数
- **gasUsed**：实际消耗的 Gas 数量。  
- **gasPrice**：用户愿意支付的 Gas 单价（以 **Gwei** 为单位，1 Gwei = 10^9 Wei）。  

交易费用计算公式：  

```
交易费用 = gasUsed × gasPrice

```

例如：

```
gasUsed = 120,000
gasPrice = 50 Gwei

交易费用 = 120,000 × 50 Gwei = 6,000,000 Gwei = 0.006 ETH
```

### Gas Limit
由于无法事先精确预测合约执行需要多少 Gas，用户必须在交易时设定一个 **Gas Limit**：  
- 如果执行完成后有剩余 → 退还。  
- 如果执行过程中耗尽 → 交易失败，但已消耗的 Gas 不会退还。  

示例：  

```
gasLimit = 150,000
gasPrice = 50 Gwei
预支付费用 = 150,000 × 50 Gwei = 0.0075 ETH
```

若实际执行消耗 `120,000 Gas`：  
- 实际交易费 = 0.006 ETH  
- 剩余退回 = 0.0015 ETH  

---

## 交易手续费的动态性
- **Gas Price** 由市场供需决定，类似竞价：  
  - 交易少时，Gas Price 下降；  
  - 交易多、网络拥堵时，Gas Price 上升。  
- 用户可以在 [Etherscan](https://etherscan.io/gastracker) 等网站实时查询 Gas 价格。  

---

## 交易收据（Receipt）
每笔交易完成后都会生成一个 **回执（Receipt）**，表示最终执行状态。  
主要字段包括：  
- `status`：1 成功，0 失败  
- `gasUsed`：实际消耗的 Gas  
- `txHash`：交易哈希  
- `logs`：合约执行产生的事件日志  
- 其他相关信息  

---

## 转账交易示例
交易哈希：`0xb940...4ad7`

- **Transaction Hash**：交易唯一标识  
- **Status**：成功  
- **From**：`0x0FFf...bBc4`（发送方）  
- **To**：`0x5b2a...5a46`（接收方）  
- **Value**：1.6912 ETH  
- **Gas Price**：82 Gwei  
- **Gas Limit**：21,000  
- **Usage by Txn**：21,000 (100%)，标准转账固定消耗  
- **Nonce**：0（表示该账户的第 1 笔交易）  
- **Input Data**：为空（转账没有额外输入）  

---

## 合约交易示例
交易哈希：`0x8aff...8cd0`

- **From**：`0x2329...BA3a`（发起方，外部账户）  
- **To**：`0x7a25...488D`（合约地址）  
- **Value**：4.5 ETH  
- **Gas Limit**：152,533（发起时设置的最大值）  
- **Usage by Txn**：125,290 (82.14%)（实际消耗）  
- **Input Data**：`0x7ff36ab5...`（包含函数调用及参数，解码后为 `swapExactETHForTokens`）  

---

## 交易树和数据树创建的过程

- https://www.yuque.com/tmfl/block_chain/kue9x22qgk53gqw5#492bdae1

## 📌 总结
- **以太坊交易**分为转账和合约调用两类。  
- **Gas 机制**保证了智能合约的可执行性和安全性。  
- **转账交易**固定消耗 21,000 Gas。  
- **合约交易**无法准确预估 Gas，用 **gasLimit** 防止执行失败。  
- Gas Price 由市场决定，交易回执记录了最终的执行结果。  


